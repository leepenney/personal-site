<!DOCTYPE html><html lang="en-GB"><head><meta charset="utf-8"><title>A Cheaper Home Automation Solution &gt; Tech &gt; Lee Penney</title><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><meta name="description" content="A while back I set up a little home automation using a USB 433Mhz transmitter to control some RF sockets I had lyin"><meta property="og:title" content="A Cheaper Home Automation Solution"><meta property="og:description" content="A while back I set up a little home automation using a USB 433Mhz transmitter to control some RF sockets I had lyin"><meta property="og:url" content="https://www.leepenney.com/tech/a-cheaper-home-automation-solution.html"><meta property="og:type" content="article"><link rel="canonical" href="https://www.leepenney.com/tech/a-cheaper-home-automation-solution.html"><link rel="icon" href="https://www.leepenney.com/img/favicon.ico" type="image/x-icon"><style>body{color:#212121;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;letter-spacing:.02em;padding:0 20px;margin:0 auto;max-width:800px}a{color:#212121;text-decoration:none}dt{font-weight:700;font-size:1.2em}dt a{display:block;padding:10px 0 5px 0}dd,div.meta{margin:0 0 1em 0;color:#aaa;font-size:90%}code{font-family:monospace;font-size:120%}header{border-bottom:1px solid;padding:20px 0}header:after{content:"";display:table;clear:both}header svg{float:left;margin:0 10px 0 0}header nav,header span{vertical-align:middle}header nav{line-height:55px}header nav a{border-bottom:1px dotted}main{margin:20px 0}main.home section{display:grid;grid-template-columns:1fr 1fr;grid-auto-rows:calc((100vw - 40px)/ 2);column-gap:10px;row-gap:10px;margin:0 0 3em 0;grid-template-rows:2em}.cat-block{display:block;color:#fff;background:#212121;text-decoration:none;text-align:center;line-height:calc((100vw - 40px)/ 2)}.cat-block:nth-child(1){grid-column-start:1;grid-column-end:3;line-height:normal;color:#212121;background:#fff}span.tag{background:#eaedee;display:inline-block;margin:0 7px 0 0;border-radius:5px;padding:0 10px}main.books dl{padding:0 0 0 90px}main.books dd:after{content:"";display:table;clear:both}main.books dl img{height:120px;width:80px;float:left;margin:-1.6em 0 0 -90px}article img{max-width:100%;height:auto}article hr{display:none}article table{border-collapse:collapse;border:none!important;margin:1em auto}article tr{border-bottom:1px dotted}article td,article th{border:none!important;padding:.5em 1em}article li{margin:0 0 1em 0}article a{border-bottom:1px dotted}main.book article img{height:180px;width:120px;display:block;margin:0 1em 0 0;float:left}main.book article p:first-of-type+ul{list-style-type:none;float:left;padding:0;width:120px;margin:1em 1em 1em 0;font-size:90%;clear:left;text-transform:uppercase;text-align:center}main.book article ul a{display:block;background:#000;color:#fff;line-height:40px;padding:5px;font-size:80%;font-weight:700;margin:0 0 2px 0}form{max-width:400px;margin:0 auto}label{display:block;margin:0;padding:0}input{display:block;font-size:1em;margin-bottom:1em;width:100%;padding:5px;box-sizing:border-box}input[type=submit]{background:#000;color:#fff;border:0;height:40px}main.book section{border-top:1px solid}footer{border-top:1px solid}@media screen and (min-width:800px){header span{line-height:55px}main.home section{grid-template-columns:repeat(4,1fr);grid-auto-rows:1fr;grid-template-rows:unset}.cat-block:nth-child(1){grid-column-start:1;grid-column-end:2;font-weight:700;line-height:195px}.cat-block:nth-child(3n+2){grid-column-start:2}.cat-block{line-height:195px}main.books dl{padding:0;display:grid;grid-template-columns:1fr 1fr;grid-auto-flow:dense}main.books dt{padding:0 0 0 calc(73px + 1em)}main.books dl>:nth-of-type(odd){grid-column:1}main.books dl>:nth-of-type(even){grid-column:2}main.books dl img{margin:-1em 1em 0 0}}</style></head><body><header><a href="/"><svg version="1.0" xmlns="http://www.w3.org/2000/svg" width="55" height="55" viewBox="0 0 400 400"><path d="M0 200v200h400V0H0v200zm60-68v60l56.3-.2 56.2-.3.5-40c.6-45.8.6-45.5 9.5-57.9 7.7-10.7 19.8-18.1 34.2-20.7 3.2-.6 26.4-.9 57.5-.6 46.5.3 53 .5 58.2 2.1 22.7 6.8 38.1 21.9 46.3 45.6 2.4 7 2.7 9 3.1 29.1.3 19.5.2 22.5-1.7 29.9-5.2 20.7-17 34.9-36.6 44-12.2 5.8-19.5 7-40.7 7-10.1 0-34.8.3-55 .7l-36.8.6V344h-39.3l.6-57 .7-57h-67.5c-58.7 0-68-.2-71.3-1.5-4.9-2.1-8.1-5.2-10.3-10-1.7-3.8-1.9-8.1-1.9-75.3V72h38v60z"/><path d="M219 111.3c-1.9.7-4.4 2.7-5.7 4.6-2.3 3.4-2.3 3.5-2.3 39.8v36.4l54.8-.3 54.7-.3 5.6-2.6c6.5-3.1 11.9-8.2 15.1-14.2 2.1-3.9 2.3-5.4 2.3-22.2 0-17.7-.1-18.1-2.8-24.1-3.4-7.4-8.4-12.5-15.2-15.6-5-2.3-5.2-2.3-54-2.5-36.3-.2-49.9.1-52.5 1z"/></svg></a><nav><a href="https://www.leepenney.com/index.html">Home</a> &gt; <a href="https://www.leepenney.com/tech">Tech</a></nav></header><main class="features tech vfd"><article><h1>A Cheaper Home Automation Solution</h1><div class="meta">30 Jan, 2015 | <span class="tag">Features</span><span class="tag">Tech</span><span class="tag">Vfd</span></div><p>A while back I set up a little <a href="http://viewfinderdesign.co.uk/archive/539/a-little-home-automation/">home automation using a USB 433Mhz transmitter</a> to control some RF sockets I had lying around. The primary aim was to replace the timer I used to run my lamps, which needed constant changing throughout the year.</p><p><a href="http://viewfinderdesign.co.uk/wp-content/uploads/2015/01/byron-remote-socket.jpg"><img class="alignright size-thumbnail wp-image-605" style="margin:0 0 0 10px;float:right" src="https://www.leepenney.com/img/byron-remote-socket-150x150.jpg" alt="Byron Remote Socket" width="150" height="150"></a>It worked, and I even made a couple of tweaks to update the timer so that it automatically came on around sunset, thereby switching itself on at an appropriate (ish) time without any interaction from me.</p><p>The project wasn't particularly expensive, using a Telldus TellStick that cost about £55. I also needed a computer to trigger it, which I already had. The two combined make it quite expensive if you wanted to start from scratch, and the TellSticks aren't easy to find (in the UK at least). Other alternative USB transmitters are dearer still.</p><p>With the arrival of the Raspberry Pi I could solve the issue of an expensive computer, plus reduce the power required. I started looking around and thought I could use a cheap 433Mhz transmitter and use the Pi's GPIO pins to drive it. And so my quest began.</p><h3>Initial Failure</h3><p>As I said, I had done my research. Google and the <a href="http://www.raspberrypi.org/forums/">Pi forums</a> proved my friend and I soon decided to grab a small 433Mhz transmitter from Amazon, <a href="http://www.amazon.co.uk/gp/product/B007XEXICS?tag=eighteighttem-21">this one in fact</a>. Which cost a rather pricey £5.59 (for this sort of transmitter anyway, see below).</p><p><a href="http://viewfinderdesign.co.uk/wp-content/uploads/2015/01/433mhz-transmitter.jpg"><img class="alignleft size-thumbnail wp-image-599" style="margin:0 10px 0 0" src="https://www.leepenney.com/img/433mhz-transmitter-150x150.jpg" alt="433Mhz transmitter" width="150" height="150"></a>I also picked up some jumper wires, figuring I could simply attach them onto the GPIO pins and the pins on the transmitter. That didn't go so well. I eventually gave up and purchased a GPIO starter kit off eBay (doesn't look like it's on eBay any more, but you can still buy direct from <a href="http://www.smart-elex.co.uk/RASPBERRY-Pi-GPIO-ACCESSORIES/RPI-Electronics-kit2">Smart-Elex</a>, plenty of others are available too).</p><p>For £9.50, the kit provided me with a some LEDs, switches, resistors, a heap of jumper cables and, more importantly, an 830 point breadboard, a cable and a GPIO breakout kit (like the Cobbler). This made working on things much easier.</p><p>I tried a lot of different libraries (rf-bitbanger, RCSwitch-pi, and others) but couldn't get it work, so gave up and figured I would some back to it later, hoping someone would develop an easier solution.</p><p>In hindsight, I had two problems:</p><ol><li>It appears I didn't have my transmitter wired up correctly (there isn't anything on the pins to indicate what does what aside from the antenna).</li><li>I didn't have a receiver to allow me to capture the signals from my handset, so I had to rely on what others had found.</li></ol><h3>A Second Go</h3><p>It came back around to me thinking about the project again (<a href="http://www.raspberrypi.org/controlling-electrical-sockets-with-energenie-pi-mote/">thanks to this post</a>) and I started yet more research. I liked the look of <a href="http://www.pilight.org/">pilight</a> (although I found it hard to install, with apt-get failing on me, got there with a git clone). Around this time I figured out my transmitter had been hooked up wrong so was excited to try this new option.<br></p><hr id="read-more"><p>Still no go though. I wasn't even sure if the transmitter was sending anything, so I figured I would order a kit containing a transmitter and receiver, in case I had destroyed my transmitter with the faulty wiring (I hadn't).</p><p><a href="http://viewfinderdesign.co.uk/wp-content/uploads/2015/01/433mhz-transmitter-receiver.jpg"><img class="alignright size-thumbnail wp-image-600" style="margin:0 0 0 10px;float:right" src="https://www.leepenney.com/img/433mhz-transmitter-receiver-150x150.jpg" alt="433mhz transmitter receiver kit" width="150" height="150"></a>After a bit of research I opted for <a href="http://www.ebay.co.uk/itm/433MHz-Transmitter-and-Receiver-Pair-for-Pi-Arduino-Remote-Wireless-UK-/321653066869?">a pair that seemed to match those in a couple of tutorials</a>. The pack cost £1.89 including postage.</p><p>I stuck with my original transmitter and hooked up my receiver. I tried a few of the default protocols, looking again at what my sockets used (they're <a href="http://viewfinderdesign.co.uk/wp-content/uploads/2015/01/byron-remote-socket.jpg">Byron RS3 units</a>). Everything I could find suggested they used the Bye Bye Standby (BBSB) protocol, which pilight can send as kaku_switch_old (apparently). No joy with that.</p><p>The pilight toolset includes a receiver and debugger. So I fired these up and tested my receiver. The good news was I was picking things up, but even without pressing a button the system would register events using receive (and raw just streamed numbers, it may have been a noise issue). Debug did pick up some raw code, but when I tried transmitting it, nothing happened to my socket (the receiver registered it was sending).</p><p>Back to the internet and I found <a href="http://www.princetronics.com/how-to-read-433-mhz-codes-w-raspberry-pi-433-mhz-receiver/">an article on using 433Utils</a> (from Ninjablocks). That enabled me to capture the codes being sent by the handset that came with the sockets. Using this code and the included codesend application in the <a href="https://github.com/ninjablocks/433Utils">433Utils library</a> I was able to turn sockets on and off.</p><p>I was worried the range wouldn't be too good, but when I put in the code of a unit attached to my lamp it picked it up fine. That was downstairs and across the other side of the house, ten metres or more.</p><p>So I could do it from a command line, but could I do it from a web page, as I do with my existing solution? Well, it took a lot of figuring out, but yes, I finally succeeded in doing so.</p><h3>A Cheaper Alternative</h3><p>My original solution was quite pricey, but how did this option compare?</p><p>Well, I plugged my TellStick (£55) into my Shuttle XS35 machine (£180), so you could argue it was £235. Equally, I already had the machine, so you could say £55.</p><p>For the new solution you're looking at buying a Pi. My Model B seems to be going for around £29 at the moment, but you could pick up a Model B+ for £23 and you should be able to run this on a Model A+ (£19), although you'd need a Wi-Fi adapter too (£5) so it works out about the same. You'd also need a power supply (£7), a memory card (£8) and a case (£5). That's £43 if you went the B+ route. You can pick up a kit of the lot for £36 though (all prices from Amazon and rounded up).</p><p>Add to that the cost of the transmitter (£6) and receiver (£2) and you're still under the price of the TellStick (the total coming to £44). I've left off the breadboard kit, but even going high and allowing £10 for something similar brings you in under (£54). That's assuming you buy it all new, there's a chance you have some of these things.</p><p>I couldn't find the TellStick available in the UK, only the more expensive models in the range (starting at £70), so we're well inside that cost, even if you don't include a machine to run it on.</p><p>Although the XS35 is low power, it still uses far more energy than the Pi, so there's an argument for ongoing running costs being in the new solution's favour as well.</p><h2>Replicating What I Did</h2><p>All well and good, but how do you get your system up and running like mine? Well, you're going to need to follow these steps (after purchasing the requisite hardware, obviously).</p><h3>1. Connect your transmitter and receiver</h3><p>The connections are fairly simple, you connect a 5v pin (I used pin 2 for both devices) and the ground (pin 6) to the relevant pins on your transmitter and receiver. Then comes data.</p><p>I connected pin 17 (GPIO/wiringPi pin 0) to my transmitter and pin 21/27 (depending on whether you have a rev 1 or 2 board, GPIO/wiringPi pin 2) to my receiver. Here's the <a href="http://wiringpi.com/pins/">pin listing from wiringPi</a> for easy reference.</p><p><a href="http://viewfinderdesign.co.uk/wp-content/uploads/2015/01/wired-up-transmitter-receiver-433mhz.jpg"><img class="aligncenter size-medium wp-image-604" style="display:block;margin:0 auto" src="https://www.leepenney.com/img/wired-up-transmitter-receiver-433mhz-300x225.jpg" alt="Breadboard with transmitter and receiver" width="300" height="225"></a></p><h3>2. Install WiringPi</h3><p>To install WiringPi on your Pi use:</p><p>[code]cd ~/<br>git clone git://git.drogon.net/wiringPi<br>cd wiringPi<br>./build[/code]</p><p><small>Note, Git should already be installed, if not, use</small></p><p>[code]sudo apt-get install git[/code]</p><h3>3. Install 433Utils</h3><p>To install the 433Utils kit, use:</p><p>[code]cd ~/<br>git clone git://github.com/ninjablocks/433Utils.git<br>cd 433Utils/RPi_utils<br>make[/code]</p><h3>4. Capture the codes</h3><p>To capture the codes being sent by your handset, you first need to run the RFSniffer command:</p><p>[code]sudo ~/433Utils/RPi_utils/RFSniffer[/code]</p><p>With that running, get your handset close to the receiver (like right up alongside) and hit the buttons you want to capture codes for. You may want to make note of the codes as you go, but at least remember the order you pressed them in.</p><p>Press CTRL+C to cancel when you're done.</p><p><a href="https://www.leepenney.com/img/RFSniffer.jpg"><img class="aligncenter size-full wp-image-601" style="margin:0 auto;display:block" src="https://www.leepenney.com/img/RFSniffer.jpg" alt="RFSniffer command line" width="602" height="387"></a></p><h3>5. Test transmit your codes</h3><p>You can now test the codes by using the compiled codesend executable, like so:</p><p>[code]sudo ~/433Utils/RPi_utils/codesend &lt;your code&gt;[/code]</p><p>If nothing happens, check the transmitter is sending by opening a second terminal window and running RFSniffer using the command in the previous step. Try to send the code again and you should see something appear in the sniffer window, if it's working.</p><p>If you don't see anything, check your wiring. If you are sending, but the device isn't responding, try moving it closer to eliminate range, or try capturing the code again to make certain it's the correct one.</p><h3>6. Controlling it from a web page</h3><p>Assuming you're now up and running, congratulations, you're now able to control your sockets from the command line. It's not a lot of use yet. You can enable the codesend command to be made from an application. Here though, I will discuss how to create a web page that can send both the on and off commands (and if you can do it from a web page you can call it from a cron task to schedule it, all sorts).</p><p>To do this, you first need to install the LAMP stack (you only really need Apache and PHP, but MySQL will come in handy if you want to build more functionality around it).</p><p>On a clean Raspbian install, apt-get struggled for me, so I would suggest running this first:</p><p>[code]sudo apt-get update[/code]</p><p>Then run:</p><p>[code]sudo apt-get install apache2 libapache2-mod-php5 php5 php5-mysql mysql-client mysql-server[/code]</p><p>You'll need to say yes to confirm the install, then pick a MySQL root password at the prompt.</p><p>To confirm it's installed, open the web browser and type 127.0.0.1 into the address bar (from the Pi itself, or put the Pi's IP address into the browser on another device). You should see a page stating: "It works!"</p><h3>7. Open access to the GPIO ports</h3><p>By default, you can't trigger the codesend command from a web page because WiringPi requires root privileges to run. To get around this you can export the pin you require. This can be done by opening rc.local using:</p><p>[code]sudo nano /etc/rc.local[/code]</p><p>Modify it by adding:</p><p>[code]sudo -u www-data /usr/local/bin/gpio export 17 out[/code]</p><p>before the last line (the one stating):</p><p>[code]exit 0[/code]</p><p>So you have:</p><p>[code]sudo -u www-data /usr/local/bin/gpio export 17 out<br>exit 0[/code]</p><p>Press CTRL+X, type y and hit Enter to save the changes. This will export the pin each time the Pi is rebooted, so next you need to reboot the Pi with:</p><p>[code]sudo reboot[/code]</p><p>Once this is done, you need to modify the codesend executable to change the pin number and use a slightly different WiringPi function. To do that, you need to edit the original file with:</p><p>[code]cd ~/433Utils/RPi_utils/<br>sudo nano codesend.cpp[/code]</p><p>Then change:</p><ul style="list-style-type:none"><li>int PIN = 0; to int PIN = 17;</li><li>wiringPiSetup to wiringPiSetupSys</li></ul><p>We you've done this, exit and save. Now rebuild the executable by running:</p><p>[code]make[/code]</p><p>Finally, you need to grant the www-data user (the web server) permissions on the GPIO ports. Not sure if this is the best approach, but I ended up going this route:</p><p>[code]sudo chown -R root:gpio /sys/class/gpio<br>sudo adduser www-data gpio[/code]</p><h3>8. The End Result</h3><p>So how do you then implement this, well <a href="http://viewfinderdesign.co.uk/wp-content/uploads/2015/01/index.php_.txt">I've put together a quick example</a>.</p><p>Open the file and modify the relevant RF codes for $on_code and $off_code, then save as index.php under /var/www.</p><p>Open your browser and point to your Pi (127.0.0.1 if on the actual machine) adding /index.php to the end. Then simply click the ON or OFF links to trigger the codesend.</p><h2>Summary</h2><p>So there you have it, a web page that can control a socket (or anything else). I use mine to control a lamp on a timer, but it could be used to do all sorts of things. Obviously you can expand this to run at specific schedules or however you wish. Once you can send the signal from code, it opens up a ton of possibilities.</p></article></main><footer><p>&copy; Lee Penney. All rights reserved.</p></footer></body></html>