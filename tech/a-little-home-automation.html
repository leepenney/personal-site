<!DOCTYPE html><html lang="en-GB"><head><meta charset="utf-8"><title>A Little Home Automation &gt; Tech &gt; Lee Penney</title><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><meta name="description" content="I’ve mentioned elsewhere that I have a lamp timer and was finding it frustrating to have to manuall"><meta property="og:title" content="A Little Home Automation"><meta property="og:description" content="I’ve mentioned elsewhere that I have a lamp timer and was finding it frustrating to have to manuall"><meta property="og:url" content="https://www.leepenney.com/tech/a-little-home-automation.html"><meta property="og:type" content="article"><link rel="canonical" href="https://www.leepenney.com/tech/a-little-home-automation.html"><link rel="icon" href="https://www.leepenney.com/img/favicon.ico" type="image/x-icon"><style>body{color:#212121;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;letter-spacing:.02em;padding:0 20px;margin:0 auto;max-width:800px}a{color:#212121;text-decoration:none}dt{font-weight:700;font-size:1.2em}dt a{display:block;padding:10px 0 5px 0}dd,div.meta{margin:0 0 1em 0;color:#aaa;font-size:90%}code{font-family:monospace;font-size:120%}header{border-bottom:1px solid;padding:20px 0}header:after{content:"";display:table;clear:both}header svg{float:left;margin:0 10px 0 0}header nav,header span{vertical-align:middle}header nav{line-height:55px}header nav a{border-bottom:1px dotted}main{margin:20px 0}main.home section{display:grid;grid-template-columns:1fr 1fr;grid-auto-rows:calc((100vw - 40px)/ 2);column-gap:10px;row-gap:10px;margin:0 0 3em 0;grid-template-rows:2em}.cat-block{display:block;color:#fff;background:#212121;text-decoration:none;text-align:center;line-height:calc((100vw - 40px)/ 2)}.cat-block:nth-child(1){grid-column-start:1;grid-column-end:3;line-height:normal;color:#212121;background:#fff}span.tag{background:#eaedee;display:inline-block;margin:0 7px 0 0;border-radius:5px;padding:0 10px}main.books dl{padding:0 0 0 90px}main.books dd:after{content:"";display:table;clear:both}main.books dl img{height:120px;width:80px;float:left;margin:-1.6em 0 0 -90px}article img{max-width:100%;height:auto}article hr{display:none}article table{border-collapse:collapse;border:none!important;margin:1em auto}article tr{border-bottom:1px dotted}article td,article th{border:none!important;padding:.5em 1em}article li{margin:0 0 1em 0}article a{border-bottom:1px dotted}main.book article img{height:180px;width:120px;display:block;margin:0 1em 0 0;float:left}main.book article p:first-of-type+ul{list-style-type:none;float:left;padding:0;width:120px;margin:1em 1em 1em 0;font-size:90%;clear:left;text-transform:uppercase;text-align:center}main.book article ul a{display:block;background:#000;color:#fff;line-height:40px;padding:5px;font-size:80%;font-weight:700;margin:0 0 2px 0}form{max-width:400px;margin:0 auto}label{display:block;margin:0;padding:0}input{display:block;font-size:1em;margin-bottom:1em;width:100%;padding:5px;box-sizing:border-box}input[type=submit]{background:#000;color:#fff;border:0;height:40px}main.book section{border-top:1px solid}footer{border-top:1px solid}@media screen and (min-width:800px){header span{line-height:55px}main.home section{grid-template-columns:repeat(4,1fr);grid-auto-rows:1fr;grid-template-rows:unset}.cat-block:nth-child(1){grid-column-start:1;grid-column-end:2;font-weight:700;line-height:195px}.cat-block:nth-child(3n+2){grid-column-start:2}.cat-block{line-height:195px}main.books dl{padding:0;display:grid;grid-template-columns:1fr 1fr;grid-auto-flow:dense}main.books dt{padding:0 0 0 calc(73px + 1em)}main.books dl>:nth-of-type(odd){grid-column:1}main.books dl>:nth-of-type(even){grid-column:2}main.books dl img{margin:-1em 1em 0 0}}</style></head><body><header><a href="/"><svg version="1.0" xmlns="http://www.w3.org/2000/svg" width="55" height="55" viewBox="0 0 400 400"><path d="M0 200v200h400V0H0v200zm60-68v60l56.3-.2 56.2-.3.5-40c.6-45.8.6-45.5 9.5-57.9 7.7-10.7 19.8-18.1 34.2-20.7 3.2-.6 26.4-.9 57.5-.6 46.5.3 53 .5 58.2 2.1 22.7 6.8 38.1 21.9 46.3 45.6 2.4 7 2.7 9 3.1 29.1.3 19.5.2 22.5-1.7 29.9-5.2 20.7-17 34.9-36.6 44-12.2 5.8-19.5 7-40.7 7-10.1 0-34.8.3-55 .7l-36.8.6V344h-39.3l.6-57 .7-57h-67.5c-58.7 0-68-.2-71.3-1.5-4.9-2.1-8.1-5.2-10.3-10-1.7-3.8-1.9-8.1-1.9-75.3V72h38v60z"/><path d="M219 111.3c-1.9.7-4.4 2.7-5.7 4.6-2.3 3.4-2.3 3.5-2.3 39.8v36.4l54.8-.3 54.7-.3 5.6-2.6c6.5-3.1 11.9-8.2 15.1-14.2 2.1-3.9 2.3-5.4 2.3-22.2 0-17.7-.1-18.1-2.8-24.1-3.4-7.4-8.4-12.5-15.2-15.6-5-2.3-5.2-2.3-54-2.5-36.3-.2-49.9.1-52.5 1z"/></svg></a><nav><a href="https://www.leepenney.com/index.html">Home</a> &gt; <a href="https://www.leepenney.com/tech">Tech</a></nav></header><main class="tech vfd features"><article><h1>A Little Home Automation</h1><div class="meta">6 Jan, 2013 | <span class="tag">Tech</span><span class="tag">Vfd</span><span class="tag">Features</span></div><p>I’ve <a href="http://thedigeratipeninsula.org.uk/2012/04/19/steal-this-idea-improved-lamp-timers/">mentioned elsewhere</a> that I have a lamp timer and was finding it frustrating to have to manually change the on/off times throughout the year as the length of the day changes. One option I suggested using a computer to to give more flexibility and control.</p><p>Well I’ve been running with a setup that does use a computer for a few months now and it seems to be working well, so well that it’s controlling my Christmas lights too. In the end I didn’t wait for a Raspberry Pi (I already have a small Linux server that’s on 24/7, so just used that instead).</p><p>In my other article I posited using something like X10 to control it, but X10 plugs and controllers are fairly expensive. I had a set of three remote controlled plugs already and a bit of searching found that they could be controlled remotely. I got the set for free, but you can pick up similar ones in supermarkets and DIY places from as little as £5. Just be sure they adhere to one of the standards (such as Bye Bye Standby or Home Easy, which seem to be the most common in the UK). To send on and off signals I settled on a simple USB stick from a Swedish company to do just that.</p><h3>The Transmitter</h3><p><img class="alignleft size-thumbnail wp-image-554" style="margin:0 10px 10px 0" alt="Telldus Tellstick" src="https://www.leepenney.com/img/108/telldus-tellstick-150x150.jpg" width="150" height="150">I opted for the <a href="http://www.telldus.se/products/range">Telldus TellStick</a>, which isn’t cheap (though it’s the cheapest of their range), but it had good support on multiple platforms (including Linux) and saved me soldering or whatnot. It cost me £54.60 (inc VAT and postage) from Audon Electronics.</p><p>The unit is underwhelmingly small and looked a little disappointing when I opened the pack, but I plugged it in and followed the instructions to download and install the application and within minutes I was able to switch a socket on and off through the control centre software.</p><p>I was thinking of using the automation as an exercise to play about with Python, but I know PHP better and there seemed a fairly simple way to get that to work (plus I already had everything installed so could get a web front-end working no problem).<br></p><hr id="read-more"><p>A few more minutes and I had a rough web page with some links I could click to trigger the socket. A static web page was never going to be enough for me though, so after a few quick scribblings to get my head around the design I knocked up a database to store the device details and some on/off timer settings.</p><p>Then I wrote a couple of simple functions to poll the timers’ table for any that were due, checked the current status of the device and switched it on or off accordingly. I set up a script to call these every minute using a cron job and voila I had a working timer.</p><p>A few more lines of code and I’d added functionality to support weekday, weekend and everyday timers so I could limit events appropriately.<span id="more-511"></span></p><h3>The Interface</h3><p><img class="size-full wp-image-547 alignleft" style="margin:0 10px 10px 0" alt="Home Automation Interface" src="https://www.leepenney.com/img/108/home-automation-interface.jpg" width="252" height="137">The timer is controlled by some simple command-line calls to the script but I also built a web page to allow me to control the devices manually (and see the status) should I wish (for turning a lamp on or off whenever I wanted). I could use the supplied remote, but the benefit of the web page is that it updates the status of the device (these are purely one-way, you don’t get feedback as to whether it’s on or off). It also means I can control the devices from anything with a web browser (my phone, tablet, desktop, etc). I could even expose the page through my router so I could access it from anywhere I have an internet connection to check the status and switch my devices on or off.</p><p>There are plenty of home automation packages out there, many of them free, which do a lot more than what I’ve built so far. I could have used one them but they seemed like overkill for such a simple setup, plus some of them just looked clunky. It also gave me a chance to tinker and I’d have needed to modify them to get the functionality I wanted anyway.</p><h3>Automatic Adjustments</h3><p>One of my goals was to stop having to make adjustments as sunrise and sunset moved. A quick hunt around led me to the sunrise and sunset times over at <a href="http://astro.ukho.gov.uk/surfbin/first.cgi">HM Nautical Almanac Office</a>. They weren’t in a great format, but I managed to download them and reformatted them in Excel so I could load them into the database via CSV. That left me with a table filled with times through to the end of 2013.</p><p>A simple script is run by a cron job each night to update the on time of the relevant timers with sunset from the table of saved values. I also modified the on function to take account of sunrise and only trigger the lamp to come on if sunrise happens after the set time (meaning it’s dark).</p><p>Subsequently I’ve found that I didn’t need to store all the times as PHP has a function to get sunrise and sunset times. I’ll modify my script at some point to switch over to this method as it’s more sustainable.</p><h3>Future Improvements</h3><p>I’ve solved my immediate problem and the timers are now more aware of the hours of daylight, but I’ve already found a few areas that could offer improvement:</p><ul><li>Make the timers aware of bank holidays and support option to disable them.At the moment the timers treat each day the same, but if I’m not getting up for work then some don’t really need to come on. I need to figure out whether these can be calculated on the fly or whether I’ll need to tell the script manually when they fall.</li><li>Make timers aware of when I’m on holiday/off work and support option to disable them.Again, if I’m not getting up then (in my case) the morning timer is redundant. I could link this to a web calendar (similar to what someone’s done <a href="http://eva-quirinius.blogspot.nl/2012/07/google-calendar-raspberry-pi-and-lights.html">here</a>) to keep up to date while avoiding duplication.</li><li>Take weather conditions into account.Obviously the light conditions are significantly affected by the weather, a sunny day will offer usable light much longer than a cloudy one.</li><li>Support single day and specific day timers.By that I mean timers for a specific date (with no repeat) or day of the week (i.e. every Tuesday).</li><li>Improve web interface to support adding and modification of timers and devices.It’s a bit rough-and-ready at the moment and if I want to create new timers or add a device I have to enter it directly on the database.</li><li>Find a cheaper solution.As easy as the TellStick is to setup it’s not a cheap option (and that’s assuming you have a computer to run it). You can pick up a 433Mhz transmitter (most of these systems all use that frequency) for around £3. As the lucky recipient of a Raspberry Pi I’ll be trying to figure out how you could build the whole system for less than the cost of a TellStick.</li></ul><h3>Summary</h3><p>I had to make a few tweaks to get my system to work correctly, but it’s now been working reliably for a few months and I’ve already stopped worrying about it, it’s become an automatic system I’ll just leave to run unaided (except for the tweaks mentioned above).</p><p>You’re limited more by the number of devices the protocol supports than the TellStick (16 on the ones I have) and as it supports such a <a href="http://www.telldus.se/products/compability">wide range of protocols</a> I could use it for a whole lot more than I am. I’d like to get things like my hot water and central heating on a similar system, potentially some curtain closers too (if I can find something suitable).</p><p>That’s barely scratching the surface of what you could do with it, but considering how easy (and relatively cheap) it is to get home automation up and running it’s a wonder why more people aren’t doing it.</p></article></main><footer><p>&copy; Lee Penney. All rights reserved.</p></footer></body></html>