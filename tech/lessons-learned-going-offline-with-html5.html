<!DOCTYPE html><html lang="en-GB"><head><meta charset="utf-8"><title>Lessons Learned Going Offline with HTML5 &gt; Tech &gt; Lee Penney</title><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><meta name="description" content="I recently built a simple web-based CRM tool only to run into a problem: my users didn’t have internet access all the time, so couldn’t reach it when on the road. Primary use was going to be on pho"><meta property="og:title" content="Lessons Learned Going Offline with HTML5"><meta property="og:description" content="I recently built a simple web-based CRM tool only to run into a problem: my users didn’t have internet access all the time, so couldn’t reach it when on the road. Primary use was going to be on pho"><meta property="og:url" content="https://www.leepenney.com/tech/lessons-learned-going-offline-with-html5.html"><meta property="og:type" content="article"><link rel="canonical" href="https://www.leepenney.com/tech/lessons-learned-going-offline-with-html5.html"><link rel="icon" href="https://www.leepenney.com/img/favicon.ico" type="image/x-icon"><style>body{color:#212121;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;letter-spacing:.02em;padding:0 20px;margin:0 auto;max-width:800px}a{color:#212121;text-decoration:none}dt{font-weight:700;font-size:1.2em}dt a{display:block;padding:10px 0 5px 0}dd,div.meta{margin:0 0 1em 0;color:#aaa;font-size:90%}code{font-family:monospace;font-size:120%}header{border-bottom:1px solid;padding:20px 0}header:after{content:"";display:table;clear:both}header svg{float:left;margin:0 10px 0 0}header nav,header span{vertical-align:middle}header nav{line-height:55px}header nav a{border-bottom:1px dotted}main{margin:20px 0}main.home section{display:grid;grid-template-columns:1fr 1fr;grid-auto-rows:calc((100vw - 40px)/ 2);column-gap:10px;row-gap:10px;margin:0 0 3em 0;grid-template-rows:2em}.cat-block{display:block;color:#fff;background:#212121;text-decoration:none;text-align:center;line-height:calc((100vw - 40px)/ 2)}.cat-block:nth-child(1){grid-column-start:1;grid-column-end:3;line-height:normal;color:#212121;background:#fff}span.tag{background:#eaedee;display:inline-block;margin:0 7px 0 0;border-radius:5px;padding:0 10px}main.books dl{padding:0 0 0 90px}main.books dd:after{content:"";display:table;clear:both}main.books dl img{height:120px;width:80px;float:left;margin:-1.6em 0 0 -90px}article img{max-width:100%;height:auto}article hr{display:none}article table{border-collapse:collapse;border:none!important;margin:1em auto}article tr{border-bottom:1px dotted}article td,article th{border:none!important;padding:.5em 1em}article li{margin:0 0 1em 0}article a{border-bottom:1px dotted}main.book article img{height:180px;width:120px;display:block;margin:0 1em 0 0;float:left}main.book article p:first-of-type+ul{list-style-type:none;float:left;padding:0;width:120px;margin:1em 1em 1em 0;font-size:90%;clear:left;text-transform:uppercase;text-align:center}main.book article ul a{display:block;background:#000;color:#fff;line-height:40px;padding:5px;font-size:80%;font-weight:700;margin:0 0 2px 0}form{max-width:400px;margin:0 auto}label{display:block;margin:0;padding:0}input{display:block;font-size:1em;margin-bottom:1em;width:100%;padding:5px;box-sizing:border-box}input[type=submit]{background:#000;color:#fff;border:0;height:40px}main.book section{border-top:1px solid}footer{border-top:1px solid}@media screen and (min-width:800px){header span{line-height:55px}main.home section{grid-template-columns:repeat(4,1fr);grid-auto-rows:1fr;grid-template-rows:unset}.cat-block:nth-child(1){grid-column-start:1;grid-column-end:2;font-weight:700;line-height:195px}.cat-block:nth-child(3n+2){grid-column-start:2}.cat-block{line-height:195px}main.books dl{padding:0;display:grid;grid-template-columns:1fr 1fr;grid-auto-flow:dense}main.books dt{padding:0 0 0 calc(73px + 1em)}main.books dl>:nth-of-type(odd){grid-column:1}main.books dl>:nth-of-type(even){grid-column:2}main.books dl img{margin:-1em 1em 0 0}}</style></head><body><header><a href="/"><svg version="1.0" xmlns="http://www.w3.org/2000/svg" width="55" height="55" viewBox="0 0 400 400"><path d="M0 200v200h400V0H0v200zm60-68v60l56.3-.2 56.2-.3.5-40c.6-45.8.6-45.5 9.5-57.9 7.7-10.7 19.8-18.1 34.2-20.7 3.2-.6 26.4-.9 57.5-.6 46.5.3 53 .5 58.2 2.1 22.7 6.8 38.1 21.9 46.3 45.6 2.4 7 2.7 9 3.1 29.1.3 19.5.2 22.5-1.7 29.9-5.2 20.7-17 34.9-36.6 44-12.2 5.8-19.5 7-40.7 7-10.1 0-34.8.3-55 .7l-36.8.6V344h-39.3l.6-57 .7-57h-67.5c-58.7 0-68-.2-71.3-1.5-4.9-2.1-8.1-5.2-10.3-10-1.7-3.8-1.9-8.1-1.9-75.3V72h38v60z"/><path d="M219 111.3c-1.9.7-4.4 2.7-5.7 4.6-2.3 3.4-2.3 3.5-2.3 39.8v36.4l54.8-.3 54.7-.3 5.6-2.6c6.5-3.1 11.9-8.2 15.1-14.2 2.1-3.9 2.3-5.4 2.3-22.2 0-17.7-.1-18.1-2.8-24.1-3.4-7.4-8.4-12.5-15.2-15.6-5-2.3-5.2-2.3-54-2.5-36.3-.2-49.9.1-52.5 1z"/></svg></a><nav><a href="https://www.leepenney.com/index.html">Home</a> &gt; <a href="https://www.leepenney.com/tech">Tech</a></nav></header><main class="Expert Tips Tips vfd tech"><article><h1>Lessons Learned Going Offline with HTML5</h1><div class="meta">10 Mar, 2013 | <span class="tag">Expert Tips</span><span class="tag">Tips</span><span class="tag">Vfd</span><span class="tag">Tech</span></div><p>I recently built a simple web-based CRM tool only to run into a problem: my users didn’t have internet access all the time, so couldn’t reach it when on the road. Primary use was going to be on phones and tablets, so I could have built a native app, but with both Android and iOS devices to support it would have meant learning two new coding environments or a framework which could publish to both.</p><p>Having played with some of the features in HTML5 I was aware it had the ability to work offline, storing data locally. So I did a bit of research and began knocking something together. I thought I’d outline some of the lessons I learned on the way.</p><p>Giving credit where it’s due, I leant heavily on<a href="http://alxgbsn.co.uk/2010/12/18/using-html5-localstorage-as-a-fallback-for-offline-form-submission/"> Alex Gibson’s example</a>, you can find his code on <a href="https://github.com/alexgibson/OfflineForm">Github</a>.</p><h3>Making a web page available offline</h3><p>To make a file available offline, you need to create a <a href="http://www.html5rocks.com/en/tutorials/appcache/beginner/">cache manifest</a>. Some of the older tutorials I found name it with a .manifest file type (e.g. offline.manifest, cache.manifest) but this didn’t work for me, you need to name it with a .appcache file extension (e.g. offline.appcache).</p><p>In there you need to reference all the files and resources you want available offline, and you can also set which files should never be cached as well as what to do if someone tries to access a page which is not available.</p><p>To make it easier, I created a completely separate file (offline.html) to do everything I wanted when there was no internet access, using Ajax, in one page.</p><p>I did add support to my .htaccess for a cache-manifest content type, but it worked fine before I had done that.<br></p><hr id="read-more"><span id="more-599"></span><p></p><h3>Application cache ‘gotchas’</h3><p>One gotcha I found with the manifest was that my users were never going to visit the offline.html page when using the ‘live’ site, so I need to get their browser to download the necessary files when they visited any page. Initially I did this by adding the manifest reference to my shared header code, so it appeared on every page. <strong>Do no do this</strong>.</p><p>Any page you add the manifest reference to will also be cached, on top of the files in the manifest. Apart from wasting space, you’ll find that the cached version is used in preference over the ‘live’ version, so even if you do have access to the site the local cached copy is served, which means you get out-of-date pages or weird things happening (on search pages, for example). It took a bit of time for me to figure out what was going on.</p><p>To get around this I used the <a href="http://alistapart.com/article/application-cache-is-a-douchebag">hidden iframe approach outlined by Jake Archibald</a> (and that article has a good summary of all of the problems with application cache).</p><p>Another thing to look out for is if you update any of the files listed in the manifest, they won’t automatically be updated in the local cache of a visitor unless the manifest itself has been updated, so include a date/time/version reference you can update each time any of the files in the manifest is changed.</p><h3>Storing data offline</h3><p>For my CRM application I wanted to store a list of customers and account numbers to be selected from so as to avoid anyone entering an incorrect account number and the system not being able to find it when saving to the server. HTML5 provides a number of ways to store data offline:</p><ul><li><span style="line-height:13px"><a href="http://caniuse.com/#feat=sql-storage">WebSQL</a> – Well supported in the two main mobile browsers, but has been deprecated in favour of IndexedDB.</span></li><li><a href="http://caniuse.com/#feat=indexeddb">IndexedDB</a> – Not supported in Safari or either of the two mobile browsers.</li><li><a href="http://caniuse.com/#feat=namevalue-storage">Web/Local Storage</a> – Not a database like the other options, but allows storage of key-value pairs. Well supported in desktop and mobile browsers.</li></ul><p>I’d have preferred to use one of the database solutions as I was going to need to query it, but there was no guarantee WebSQL would be supported in future versions of the two mobile clients I was interested in and with IndexedDB not yet supported I was left with little choice.</p><p>Rather than create thousands of entries, one for each customer (or whatever you’re storing), the easier approach is to store it in one entry as a JSON string. I used the same approach for storing the submitted form data for any customer notes/actions.</p><p>Note that there is a 5Mb size limit for storage (you can ask for more from the user, but only for WebSQL/IndexedDB databases) and you can only store strings, no objects or anything else (largely, though some browsers may allow).</p><h3>A note on mobile UIs</h3><p>Originally I planned to show the customer list as one large dropdown, but with so many entries it was unwieldy and there is no default type-to-search functionality on mobile as there is with desktop browsers. I looked at a couple of combobox approaches, which allowed searching, but I had issues with selecting entries in one or both mobile browsers I had to support.</p><p>In the end I made a text box that triggered an Ajax search when typed in (simply iterating through the customer list) and then displayed any matches below, the user then clicks to select the customer so notes/actions could be entered against them. I had a bit of fun getting the right trigger event as they seem to be handled differently by iOS and Android, in the end I settled on keydown rather than keypress.</p><h3>Syncing data</h3><p>As I said, any form submissions were saved into local storage, but I didn’t want the user to have to manually synchronise this back to the server when they were connected. Thankfully there are some events triggered when the browser detects the state of the connection, so I called a function from the ‘online’ event which looped through the locally stored items, checking if they were data for the server (as opposed to data I’d stored for the offline use) and then firing a call via Ajax to a simple API before removing the entry from the local store.</p><p>One thing to look out for is sending data that includes things like ampersands (&amp;) in the JSON data you submit (if you don’t plan to decode first) as they’ll be interpreted as a separate variable, to avoid this you need to encode the form data before you save it.</p><h3>Summary</h3><p>It took a bit of trial and error as well as some head scratching, but in the end I was quite pleased with the results and the functionality I could get (albeit for a relatively simple application). It shows the power that is starting to appear in HTML5, though some locked-down standards (especially for offline databases) would be nice.</p><p>Hopefully this article will help you avoid some of the pitfalls I ran into.</p></article></main><footer><p>&copy; Lee Penney. All rights reserved.</p></footer></body></html>